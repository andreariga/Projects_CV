<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokémon Info</title>
    <link rel="stylesheet" href="../css/stylePokemon.css">
    <link rel="stylesheet" href="../css/styleHeader.css">
    <link rel="stylesheet" href="../css/styleFooter.css">
    <script src="../js/template-loader.js"></script>
    <script>
        
        document.addEventListener("DOMContentLoaded", async function () {
            const params = new URLSearchParams(window.location.search);
            const idPokemon = params.get("id");
            const shiny = params.get("shiny");
            const colors = {
                fire: '#FDDFDF', grass: '#DEFDE0', electric: '#FFD700', water: '#DEF3FD',
                ground: '#f4e7da', rock: '#d5d5d4', fairy: '#FFC0CB', poison: '#A040A0',
                bug: '#A8B820', dragon: '#97b3e6', psychic: '#D83367', flying: '#A8A8F0',
                fighting: '#7D1F1A', normal: '#F5F5F5', ice: '#C0F0FF', ghost: '#735797',
                steel: '#B8B8D0', dark: '#4F3A2D',
            };

            if (!idPokemon) {
                console.error("ID del Pokémon non trovato nell'URL");
                return;
            }

            console.log("ID Pokémon:", idPokemon);

            try {
                const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${idPokemon}`);
                
                if (!response.ok) {
                    throw new Error("Errore nel caricamento dei dati");
                }

                const data = await response.json();
                console.log(data);

                document.getElementById("pokemon-name").innerText = data.name;
                if (shiny == 1)
                {
                    document.getElementById("pokemon-img").src = data.sprites.other["official-artwork"].front_shiny;
                }
                else
                {
                    document.getElementById("pokemon-img").src = data.sprites.other["official-artwork"].front_default;
                }
                
                document.getElementById("pokemon-type").innerText = data.types.map(type => type.type.name).join(" / ");
                document.getElementById("pokemon-exp").innerText = data.base_experience;
                document.getElementById("pokemon-height").innerText = data.height / 10 + "m";
                document.getElementById("pokemon-weight").innerText = data.weight / 10 + "kg";
                counter = 0;
                const pokecard = document.getElementById("pokemon-card")
                const stats = document.getElementById("stats")
                const abilities = document.getElementById("pokemon-abilities")
                if (data.types[0]) {
                    if (colors[data.types[0].type.name]) {
                        pokecard.style.backgroundColor = colors[data.types[0].type.name];
                        stats.style.backgroundColor = colors[data.types[0].type.name];
                        abilities.style.backgroundColor = colors[data.types[0].type.name];
                    } else {
                        card.style.backgroundColor = '#fff';
                    }
                } else {
                    card.style.backgroundColor = '#fff';
                }

                document.getElementById("stats").querySelectorAll("span").forEach(span => {

                    span.innerText+=` ${data.stats[counter].base_stat}`;
                    counter++;
                    console.log(counter)

                });
                

                document.getElementById("pokemon-abilities").innerHTML = data.abilities.map(a => `<p>${a.ability.name}</p>`).join("");
                document.getElementById("pokemon-moves").innerText = data.moves.slice(0, 2).map(m => m.move.name).join(", ");
                document.getElementById("pokemon-cry-container").innerHTML =
                `<source id="pokemon-cry" src="https://raw.githubusercontent.com/PokeAPI/cries/main/cries/pokemon/latest/${data.id}.ogg" type="audio/ogg" >
                    Il tuo browser non supporta l'elemento audio.`

            } catch (error) {
                console.error("Errore nel recupero dei dati:", error);
            }
            function bottoneprofilo() {
                const contenitore = document.getElementById("navbar");
                let bottone = document.createElement("a");
                bottone.classList.add("profile-button"); 
                bottone.href = `Profilo.html`
                bottone.innerText = `profilo`;
                contenitore.appendChild(bottone);
            }

            await TemplateLoader.initializeTemplates();
            await bottoneprofilo();
        });
        function compareMenu() {
            const navLinks = document.querySelector(".nav-links2");

            if (navLinks.style.display === "none" || navLinks.style.display === "") {
                navLinks.style.display = "flex";
                navLinks.style.opacity = "1";
                navLinks.style.visibility = "visible";
                navLinks.style.transform = "translateY(0)";
            } else {
                navLinks.style.opacity = "0";
                navLinks.style.visibility = "hidden";
                navLinks.style.transform = "translateY(-10px)";
                navLinks.style.display = "none";
            }
        }

    </script>
</head>
<body>
    <div id="header-container"></div>
    <div class="container">
        <h1 id="pokemon-name"></h1>
        <div class="pokemon-card" id="pokemon-card">
            <img id="pokemon-img" src="" alt="Bulbasaur">
            <p><strong>Tipo:</strong> <span id="pokemon-type"></span></p>
            <p><strong>Esperienza Base:</strong> <span id="pokemon-exp"></span></p>
            <p><strong>Altezza:</strong> <span id="pokemon-height"></span></p>
            <p><strong>Peso:</strong> <span id="pokemon-weight"></span></p>
        </div>
        
        <h3>Statistiche</h3>
        <div id="stats" class="stats">
            <span id="stat">HP: </span>
            <span id="stat">Attacco: </span>
            <span id="stat">Difesa: </span>
            <span id="stat">Att. Speciale: </span>
            <span id="stat">Dif. Speciale: </span>
            <span id="stat">Velocità: </span>
        </div>
        
        <h3>Abilità</h3>
        <div class="abilities" id="pokemon-abilities"></div>
        
        <h3>Mosse Base</h3>
        <p id="pokemon-moves"></p>
        
        <h3>Grido</h3>
        <audio controls id="pokemon-cry-container">
            <source id="pokemon-cry" src="" type="audio/ogg" >
            Il tuo browser non supporta l'elemento audio.
        </audio>
    </div>
    <div id="footer-container"></div>
</body>
</html>